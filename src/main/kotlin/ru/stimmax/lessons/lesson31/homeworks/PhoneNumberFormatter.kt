package ru.stimmax.lessons.lesson31.homeworks

//Задание: Написание параметризованных юнит тестов для проверки преобразования номеров телефонов
//
//Описание задачи:
//
//Необходимо создать класс PhoneNumberFormatter, который будет иметь метод formatPhoneNumber принимающий и возвращающий строку. Этот метод должен преобразовывать входящую строку в стандартизированный формат номера телефона РФ +7 (XXX) XXX-XX-XX.  Если преобразование невозможно, то выдавать IllegalArgumentException.
//
//Алгоритм преобразования следующий:
//
//Очищаем строку от невалидных символов через замену всех нечисловых знаков на пустую строку. Делается это через replace который принимает regex выражение "\\D".toRegex() ( \\D - это выражение, которое находит все нечисловые значения)
//Если длина полученной числовой строки не равна 10 или 11 знакам - выкидываем исключение
//Если в строке 11 значений, то номер должен начинаться на 8 или 7, иначе выкидываем исключение что номер невалидный. Если условие верное, то удаляем первый символ.
//Создаём фрагменты номера с помощью substring и вставляем их в шаблон
//Требования к решению:
//
//Создайте заготовку метода.
//Напишите параметризованные юнит тесты, которые будут проверять различные варианты входных данных: валидные и невалидные номера телефонов.
//В тестах используйте различные источники данных для параметров: валидные номера, невалидные номера, номера с лишними символами, короткие и длинные номера.
//Примеры для тестирования:
//
//- `8 (922) 941-11-11` -> `+7 (922) 941-11-11`
//- `79229411111` -> `+7 (922) 941-11-11`
//- `+7 922 941 11 11` -> `+7 (922) 941-11-11`
//- `9229411111` -> `+7 (922) 941-11-11`
//- `abc +7 922 941 11 11` -> `+7 (922) 941-11-11`
//- `12345` -> `IllegalArgumentException` (невалидный номер)
//- `+1 (922) 941-11-11` ->  `IllegalArgumentException` (невалидный номер)

class PhoneNumberFormatter {

    fun formatPhoneNumber(source: String): String {
        // Убираем все нечисловые символы
        val digits = source.replace("\\D".toRegex(), "")

        // Длина должна быть 10 или 11
        if (digits.length != 10 && digits.length != 11) {
            throw IllegalArgumentException("Invalid phone number length")
        }

        var normalized = digits

        // Если 11 символов — номер должен начинаться с 7 или 8
        if (digits.length == 11) {
            val first = digits[0]
            if (first != '7' && first != '8') {
                throw IllegalArgumentException("Invalid phone number")
            }
            normalized = digits.substring(1)
        }

        // Теперь строго 10 цифр
        val area = normalized.substring(0, 3)
        val part1 = normalized.substring(3, 6)
        val part2 = normalized.substring(6, 8)
        val part3 = normalized.substring(8, 10)

        return "+7 ($area) $part1-$part2-$part3"
    }
}